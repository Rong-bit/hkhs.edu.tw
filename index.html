<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>高雄市小港高中發病個案疫調</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      padding: 15px;
      max-width: 800px;
      margin: 0 auto;
      background-color: #f5f5f5;
      font-size: 16px;
      color: #333;
    }
    .form-container {
      background-color: white;
      padding: 0;
      border-radius: 8px;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      border: 1px solid rgba(0,0,0,.125);
    }
    .form-title {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      padding: 20px;
      margin: 0;
      border-radius: 8px 8px 0 0;
      text-align: center;
    }
    .form-title h2 { margin: 0 0 8px 0; font-size: 24px; font-weight: 700; color: #fff; }
    .form-title p { margin: 0; font-size: 16px; font-weight: 500; color: #fff; }
    .loading { display: none; text-align: center; padding: 20px; }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #007bff;
      border-radius: 50%;
      width: 40px; height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .form-group { margin-bottom: 20px; padding: 0 20px; }
    .form-group:first-of-type { padding-top: 20px; }
    .form-group:last-of-type { padding-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 16px; }
    .required { color: #dc3545; }
    .required:after { content: " *"; color: #ff4444; }
    input, select, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
      background-color: #fff;
    }
    input:focus, select:focus, textarea:focus {
      outline: 0;
      border-color: #007bff;
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .checkbox-group label { display: flex; align-items: center; margin: 0; font-size: 16px; line-height: 1.6; font-weight: 500; color: #333; }
    .checkbox-group input[type="checkbox"] { margin-right: 10px; width: 20px; height: 20px; flex-shrink: 0; }
    .radio-group { display: flex; gap: 20px; margin-top: 10px; }
    .radio-group label { display: flex; align-items: center; margin: 0; font-size: 16px; line-height: 1.6; font-weight: 500; color: #333; }
    .radio-group input[type="radio"] { margin-right: 8px; width: 18px; height: 18px; flex-shrink: 0; }
    .symptoms-title { font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #333; }
    .date-input { display: flex; align-items: center; gap: 8px; }
    .date-input input { width: auto; min-width: 80px; }
    .activity-input { margin-top: 10px; animation: fadeIn 0.3s ease-in-out; }
    .activity-input input { width: 100%; padding: 12px 16px; border: 2px solid #007bff; border-radius: 6px; font-size: 16px; background-color: #f8f9fa; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      transition: all 0.15s ease-in-out;
    }
    .btn-primary { background-color: #007bff; color: white; }
    .btn-primary:hover { background-color: #0056b3; }
    .btn-secondary { background-color: #6c757d; color: white; }
    .btn-secondary:hover { background-color: #545b62; }
    .button-container { text-align: center; padding: 20px; background-color: #f8f9fa; border-radius: 0 0 8px 8px; }
    .error-message { color: #dc3545; font-size: 14px; margin-top: 8px; display: none; font-weight: 500; }
    .error-message.show { display: block; }
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease-in-out;
    }
    .modal.show { display: flex; align-items: center; justify-content: center; }
    .modal-content {
      background-color: #fff;
      margin: auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-in-out;
    }
    .modal-header { margin-bottom: 20px; }
    .modal-icon { font-size: 48px; color: #28a745; margin-bottom: 15px; }
    .modal-title { font-size: 24px; font-weight: 600; color: #28a745; margin-bottom: 10px; }
    .modal-message { font-size: 16px; color: #333; line-height: 1.5; margin-bottom: 25px; }
    .modal-button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .modal-button:hover { background-color: #218838; }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-30px) scale(0.9); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    .form-hint { margin: 0 0 0.5em 0; font-size: 0.9em; color: #666; }
    @media (max-width: 768px) {
      body { padding: 10px; font-size: 18px; }
      .form-group { padding: 0 15px; }
      .button-container { padding: 15px; }
      label { font-size: 18px; }
      input, select, textarea { font-size: 18px; padding: 14px 18px; }
      .form-title h2 { font-size: 28px; color: #fff !important; }
      .form-title p { font-size: 18px; color: #fff !important; }
      .btn { font-size: 18px; padding: 14px 28px; }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <div class="form-title">
      <h2>高雄市小港高中發病個案疫調</h2>
      <p>114.04.5修正</p>
    </div>
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>正在載入表單...</p>
    </div>
    <div id="form-content" style="display: none;"></div>
    <div class="button-container">
      <button type="button" class="btn btn-primary" id="submitBtn" onclick="submitForm()">送出表單</button>
      <button type="button" class="btn btn-secondary" onclick="resetForm()">重設表單</button>
    </div>
  </div>
  <div id="successModal" class="modal" onclick="closeSuccessModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon">✅</div>
        <div class="modal-title">提交成功！</div>
      </div>
      <div class="modal-message" id="modalMessage">表單已成功提交</div>
      <button class="modal-button" onclick="closeSuccessModal()">確定</button>
    </div>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbw6G72ghpopgETnc5SCsI_cNqVJmDa1sF-UEpqzg35IrpgcD_243k346d0Tbpm6zSkS/exec';
    let formData = {};

    document.addEventListener('DOMContentLoaded', function() {
      createFormHTML();
      document.getElementById('form-content').style.display = 'block';
      document.getElementById('loading').style.display = 'none';
    });

    function createFormHTML() {
      const classOptions = [];
      classOptions.push('<option value="教職同仁">教職同仁</option>');
      for (let grade = 1; grade <= 3; grade++) {
        for (let classNum = 1; classNum <= 15; classNum++) {
          const className = grade + '年' + classNum.toString().padStart(2, '0') + '班';
          classOptions.push('<option value="' + className + '">' + className + '</option>');
        }
      }

      const html = `
        <div class="form-group">
          <label class="required">姓名</label>
          <input type="text" name="name" required>
        </div>
        <div class="form-group">
          <label class="required">身分證(護照)</label>
          <input type="text" name="id" id="idInput" required placeholder="例：A123456789" maxlength="10">
        </div>
        <div class="form-group">
          <label class="required">出生日期</label>
          <input type="date" name="birthDate" required>
        </div>
        <div class="form-group">
          <label class="required">單位/班級</label>
          <select name="class" required>
            <option value="">請選擇班級</option>
            ${classOptions.join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="required">發病日（症狀出現日）</label>
          <div class="date-input">
            <input type="number" name="onsetMonth" id="onsetMonth" min="1" max="12" required placeholder="月"> 月
            <input type="number" name="onsetDay" id="onsetDay" min="1" max="31" required placeholder="日"> 日
          </div>
        </div>
        <div class="form-group">
          <label class="symptoms-title">症狀（可複選）</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="fever" value="true">發燒（耳溫≧38℃）</label>
            <label><input type="checkbox" name="muscleAche" value="true">肌肉酸痛</label>
            <label><input type="checkbox" name="headache" value="true">頭痛</label>
            <label><input type="checkbox" name="fatigue" value="true">極度倦怠感</label>
            <label><input type="checkbox" name="cough" value="true">咳嗽</label>
            <label><input type="checkbox" name="soreThroat" value="true">喉嚨痛</label>
            <label><input type="checkbox" name="shortBreath" value="true">呼吸急促</label>
            <label><input type="checkbox" name="runnyNose" value="true">流鼻涕</label>
          </div>
          <div class="form-group other-symptoms">
            <label>其他症狀</label>
            <input type="text" name="otherSymptoms" placeholder="請描述其他症狀">
          </div>
        </div>
        <div class="form-group">
          <label class="required">就醫院所（未就醫寫無）</label>
          <input type="text" name="hospital" id="hospital" required onchange="handleHospitalChange(this)">
        </div>
        <div class="form-group" id="visitDateGroup">
          <label class="required">就醫日期</label>
          <div class="date-input">
            <input type="number" name="visitMonth" min="1" max="12" required placeholder="月"> 月
            <input type="number" name="visitDay" min="1" max="31" required placeholder="日"> 日
          </div>
        </div>
        <div id="visitDateDisplay" style="display: none; color: #666; font-style: italic; padding: 0 20px 20px;">無</div>
        <div class="form-group" id="diagnosisGroup">
          <label class="required">醫師診斷</label>
          <input type="text" name="diagnosis" required placeholder="請輸入醫師診斷">
        </div>
        <div id="diagnosisDisplay" style="display: none; color: #666; font-style: italic; padding: 0 20px 20px;">無</div>
        <div class="form-group">
          <label class="required">您是否服用流感抗病毒藥劑</label>
          <select name="fluMedicine" required>
            <option value="">請選擇</option>
            <option value="自費">自費</option>
            <option value="公費">公費</option>
            <option value="無">無</option>
          </select>
        </div>
        <div class="form-group">
          <label class="required">您是否服用新冠抗病毒藥劑</label>
          <select name="covidMedicine" required>
            <option value="">請選擇</option>
            <option value="自費">自費</option>
            <option value="公費">公費</option>
            <option value="無">無</option>
          </select>
        </div>
        <div class="form-group">
          <label class="required">流感快篩</label>
          <select name="fluTest" required>
            <option value="">請選擇</option>
            <option value="未檢驗">未檢驗</option>
            <option value="陰性">陰性</option>
            <option value="陽性(A型)">陽性(A型)</option>
            <option value="陽性(B型)">陽性(B型)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="required">新冠快篩</label>
          <select name="covidTest" required>
            <option value="">請選擇</option>
            <option value="未檢驗">未檢驗</option>
            <option value="陰性">陰性</option>
            <option value="陽性">陽性</option>
          </select>
        </div>
        <div class="form-group">
          <label class="required">個案處置</label>
          <select name="treatment" id="treatment" required onchange="handleTreatmentChange()">
            <option value="">請選擇</option>
            <option value="1.回家休養">1.回家休養</option>
            <option value="2.住院">2.住院</option>
            <option value="3.其他">3.其他</option>
          </select>
        </div>
        <div class="form-group" id="hospitalizationGroup" style="display: none;">
          <label class="required">就醫紀錄-住院日期</label>
          <input type="date" name="hospitalizationDate">
        </div>
        <div class="form-group" id="hospitalizationConditionGroup" style="display: none;">
          <label class="required">就醫紀錄-住院情形(註13)</label>
          <input type="text" name="hospitalizationCondition" placeholder="請簡述住院情形">
        </div>
        <div class="form-group">
          <label>本季已接種流感疫苗日期(小港高中施打日期2025/10/20)，未接種免填</label>
          <input type="date" name="vaccineDate">
        </div>
        <div class="form-group">
          <label class="required">個案是否補習</label>
          <div class="radio-group">
            <label><input type="radio" name="cramSchoolStatus" value="2.無" id="noCram" onchange="toggleCramInput()">否</label>
            <label><input type="radio" name="cramSchoolStatus" value="1.有" id="hasCram" onchange="toggleCramInput()">是</label>
          </div>
          <div id="cramSchoolDetailsWrap" class="activity-input" style="display: none;">
            <input type="text" name="cramSchoolDetails" placeholder="例：小港捷勝">
          </div>
        </div>
        <div class="form-group">
          <label class="required">個案聯絡電話</label>
          <input type="tel" name="phone" required placeholder="例：0912345678 或 07-7172930" maxlength="12">
        </div>
        <div class="form-group">
          <label class="required">個案家人是否有疑似症狀？(註12)</label>
          <p class="form-hint">若填「是」，下列症狀紀錄欄位為必填</p>
          <select name="familyHasSymptoms" id="familyHasSymptoms" required onchange="handleFamilyHasSymptomsChange()">
            <option value="">請選擇</option>
            <option value="是">是</option>
            <option value="否">否</option>
          </select>
        </div>
        <div id="familySymptomsGroup" style="display: none;">
          <div class="form-group">
            <label class="required">個案家人症狀紀錄-與個案關係</label>
            <input type="text" name="familyRelation" placeholder="例：父親、母親、兄弟">
          </div>
          <div class="form-group">
            <label class="required">個案家人症狀紀錄-發病日</label>
            <div class="date-input">
              <input type="number" name="familyOnsetMonth" min="1" max="12" placeholder="1-12"> 月
              <input type="number" name="familyOnsetDay" min="1" max="31" placeholder="1-31"> 日
            </div>
          </div>
          <div class="form-group">
            <label class="required">個案家人症狀紀錄-是否就醫(註12)</label>
            <select name="familySawDoctor">
              <option value="">請選擇</option>
              <option value="是">是</option>
              <option value="否">否</option>
            </select>
          </div>
          <div class="form-group">
            <label class="required">個案家人症狀紀錄-就醫地點</label>
            <input type="text" name="familyDoctorPlace" placeholder="例：○○診所">
          </div>
          <div class="form-group">
            <label class="required">個案家人症狀紀錄-醫師診斷</label>
            <input type="text" name="familyDoctorDiagnosis" placeholder="例：上呼吸道感染">
          </div>
        </div>
        <div class="form-group">
          <label class="required">個案是否請假？(註12)</label>
          <p class="form-hint">若填「是」，請假日期必填</p>
          <select name="leaveStatus" id="leaveStatus" required onchange="handleLeaveStatusChange()">
            <option value="">請選擇</option>
            <option value="是">是</option>
            <option value="否">否</option>
          </select>
        </div>
        <div class="form-group" id="leaveStartGroup" style="display: none;">
          <label class="required">個案請假起始日</label>
          <div class="date-input">
            <input type="number" name="leaveStartMonth" min="1" max="12" placeholder="1-12"> 月
            <input type="number" name="leaveStartDay" min="1" max="31" placeholder="1-31"> 日
          </div>
        </div>
      `;
      document.getElementById('form-content').innerHTML = html;
      initializeFormListeners();
    }

    function toggleCramInput() {
      const wrap = document.getElementById('cramSchoolDetailsWrap');
      const input = document.querySelector('[name="cramSchoolDetails"]');
      const hasCram = document.getElementById('hasCram').checked;
      if (wrap) wrap.style.display = hasCram ? 'block' : 'none';
      if (input) { input.required = hasCram; if (!hasCram) input.value = ''; }
    }

    function handleFamilyHasSymptomsChange() {
      const val = document.getElementById('familyHasSymptoms').value;
      const group = document.getElementById('familySymptomsGroup');
      const names = ['familyRelation', 'familyOnsetMonth', 'familyOnsetDay', 'familySawDoctor', 'familyDoctorPlace', 'familyDoctorDiagnosis'];
      if (!group) return;
      if (val === '是') {
        group.style.display = 'block';
        names.forEach(function(n) {
          var el = document.querySelector('[name="' + n + '"]');
          if (el) el.required = true;
        });
      } else {
        group.style.display = 'none';
        names.forEach(function(n) {
          var el = document.querySelector('[name="' + n + '"]');
          if (el) { el.value = ''; el.required = false; }
        });
      }
    }

    function handleLeaveStatusChange() {
      const val = document.getElementById('leaveStatus').value;
      const group = document.getElementById('leaveStartGroup');
      const m = document.querySelector('[name="leaveStartMonth"]');
      const d = document.querySelector('[name="leaveStartDay"]');
      if (val === '是') {
        if (group) group.style.display = 'block';
        if (m) m.required = true; if (d) d.required = true;
      } else {
        if (group) group.style.display = 'none';
        if (m) { m.value = ''; m.required = false; }
        if (d) { d.value = ''; d.required = false; }
      }
    }

    function handleTreatmentChange() {
      const treatment = document.getElementById('treatment').value;
      const isHospital = treatment === '2.住院' || treatment.indexOf('住院') >= 0;
      const dateGroup = document.getElementById('hospitalizationGroup');
      const condGroup = document.getElementById('hospitalizationConditionGroup');
      const dateInput = document.querySelector('[name="hospitalizationDate"]');
      const condInput = document.querySelector('[name="hospitalizationCondition"]');
      if (isHospital) {
        if (dateGroup) dateGroup.style.display = 'block';
        if (condGroup) condGroup.style.display = 'block';
        if (dateInput) dateInput.required = true;
        if (condInput) condInput.required = true;
      } else {
        if (dateGroup) dateGroup.style.display = 'none';
        if (condGroup) condGroup.style.display = 'none';
        if (dateInput) { dateInput.value = ''; dateInput.required = false; }
        if (condInput) { condInput.value = ''; condInput.required = false; }
      }
    }

    function handleHospitalChange(input) {
      const v = (input && input.value) ? input.value.trim() : '';
      const isNo = v === '無' || v === '無就醫' || v === '未就醫';
      const visitGroup = document.getElementById('visitDateGroup');
      const visitDisplay = document.getElementById('visitDateDisplay');
      const diagGroup = document.getElementById('diagnosisGroup');
      const diagDisplay = document.getElementById('diagnosisDisplay');
      var visitM = document.querySelector('[name="visitMonth"]');
      var visitD = document.querySelector('[name="visitDay"]');
      var diag = document.querySelector('[name="diagnosis"]');
      if (isNo) {
        if (visitGroup) visitGroup.style.display = 'none';
        if (visitDisplay) visitDisplay.style.display = 'block';
        if (diagGroup) diagGroup.style.display = 'none';
        if (diagDisplay) diagDisplay.style.display = 'block';
        if (visitM) { visitM.value = ''; visitM.removeAttribute('required'); }
        if (visitD) { visitD.value = ''; visitD.removeAttribute('required'); }
        if (diag) { diag.value = ''; diag.removeAttribute('required'); }
      } else {
        if (visitGroup) visitGroup.style.display = 'block';
        if (visitDisplay) visitDisplay.style.display = 'none';
        if (diagGroup) diagGroup.style.display = 'block';
        if (diagDisplay) diagDisplay.style.display = 'none';
        if (visitM) visitM.setAttribute('required', 'required');
        if (visitD) visitD.setAttribute('required', 'required');
        if (diag) diag.setAttribute('required', 'required');
      }
    }

    function initializeFormListeners() {
      document.querySelectorAll('#form-content input, #form-content select, #form-content textarea').forEach(function(el) {
        el.addEventListener('change', updateFormData);
        el.addEventListener('input', updateFormData);
      });
    }

    function updateFormData() {
      formData = {};
      document.querySelectorAll('#form-content input, #form-content select, #form-content textarea').forEach(function(input) {
        if (!input.name) return;
        if (input.type === 'checkbox') formData[input.name] = input.checked ? 'true' : '';
        else if (input.type === 'radio') { if (input.checked) formData[input.name] = input.value; }
        else formData[input.name] = input.value;
      });
    }

    async function submitForm() {
      var submitBtn = document.getElementById('submitBtn');
      if (submitBtn.disabled) return;
      try {
        updateFormData();
        if (!validateForm()) return;
        showLoading(true);
        var result = await submitFormData(formData);
        if (result && result.success) {
          showSuccess(result.message || '表單提交成功！');
        } else {
          showError(result.error || '提交失敗，請重試');
        }
      } catch (err) {
        showError('提交失敗，請檢查網路連線後重試');
      } finally {
        showLoading(false);
      }
    }

    function submitFormData(data) {
      return new Promise(function(resolve) {
        var iframe = document.getElementById('form-submit-iframe');
        if (!iframe) {
          iframe = document.createElement('iframe');
          iframe.name = iframe.id = 'form-submit-iframe';
          iframe.style.cssText = 'position:absolute;width:0;height:0;border:0;visibility:hidden';
          document.body.appendChild(iframe);
        }
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = API_URL;
        form.target = 'form-submit-iframe';
        form.style.visibility = 'hidden';
        var input = document.createElement('input');
        input.name = 'data';
        input.value = JSON.stringify(data);
        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
        setTimeout(function() {
          document.body.removeChild(form);
          resolve({ success: true, message: '表單已送出，請至試算表確認。' });
        }, 1500);
      });
    }

    function validateForm() {
      var formContent = document.getElementById('form-content');
      if (!formContent) { alert('表單尚未載入，請重新整理後再試。'); return false; }
      var required = ['name', 'id', 'birthDate', 'class', 'onsetMonth', 'onsetDay', 'hospital', 'familyHasSymptoms', 'leaveStatus', 'fluMedicine', 'covidMedicine', 'fluTest', 'covidTest', 'treatment', 'cramSchoolStatus', 'phone'];
      var noHospital = (document.querySelector('[name="hospital"]') || {}).value;
      noHospital = (noHospital && (noHospital.trim() === '無' || noHospital.trim() === '無就醫' || noHospital.trim() === '未就醫'));
      if (!noHospital) required.push('visitMonth', 'visitDay', 'diagnosis');
      var treatment = (document.querySelector('[name="treatment"]') || {}).value;
      if (treatment === '2.住院' || (treatment && treatment.indexOf('住院') >= 0)) required.push('hospitalizationDate', 'hospitalizationCondition');
      var familyYes = (document.querySelector('[name="familyHasSymptoms"]') || {}).value === '是';
      if (familyYes) required.push('familyRelation', 'familyOnsetMonth', 'familyOnsetDay', 'familySawDoctor', 'familyDoctorPlace', 'familyDoctorDiagnosis');
      var leaveYes = (document.querySelector('[name="leaveStatus"]') || {}).value === '是';
      if (leaveYes) required.push('leaveStartMonth', 'leaveStartDay');
      var isValid = true;
      required.forEach(function(fieldName) {
        var input = formContent.querySelector('[name="' + fieldName + '"]');
        if (!input) return;
        if (input.type === 'radio') {
          var checked = formContent.querySelector('[name="' + fieldName + '"]:checked');
          if (!checked) { showFieldError(input, '此欄位為必填'); isValid = false; } else clearFieldError(input);
        } else if (!input.value || !input.value.toString().trim()) {
          showFieldError(input, '此欄位為必填');
          isValid = false;
        } else clearFieldError(input);
      });
      var idEl = formContent.querySelector('#idInput');
      if (idEl && !validateIdInput(idEl)) { showFieldError(idEl, '請輸入正確的身分證字號格式'); isValid = false; }
      var phoneEl = formContent.querySelector('[name="phone"]');
      if (phoneEl && !/^[0-9-]+$/.test((phoneEl.value || '').trim())) { showFieldError(phoneEl, '電話號碼格式不正確（僅數字與連字號）'); isValid = false; }
      return isValid;
    }

    function validateIdInput(input) {
      var id = (input.value || '').trim().toUpperCase();
      if (!/^[A-Z][12][0-9]{8}$/.test(id)) return false;
      var letters = 'ABCDEFGHJKLMNPQRSTUVXYWZIO';
      var letterValue = letters.indexOf(id.charAt(0)) + 10;
      var first = Math.floor(letterValue / 10), second = letterValue % 10;
      var sum = first + second * 9;
      for (var i = 1; i < 9; i++) sum += parseInt(id.charAt(i), 10) * (9 - i);
      var checkDigit = (10 - (sum % 10)) % 10;
      return checkDigit === parseInt(id.charAt(9), 10);
    }

    function showFieldError(input, msg) {
      clearFieldError(input);
      var div = document.createElement('div');
      div.className = 'error-message show';
      div.textContent = msg;
      input.parentNode.appendChild(div);
    }
    function clearFieldError(input) {
      var el = input.parentNode ? input.parentNode.querySelector('.error-message') : null;
      if (el) el.remove();
    }

    function resetForm() {
      document.querySelectorAll('#form-content input, #form-content select, #form-content textarea').forEach(function(input) {
        input.value = '';
        clearFieldError(input);
      });
      formData = {};
    }

    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'block' : 'none';
      document.getElementById('form-content').style.display = show ? 'none' : 'block';
      var btn = document.getElementById('submitBtn');
      btn.disabled = show;
      btn.textContent = show ? '提交中...' : '送出表單';
    }

    function showSuccess(msg) {
      var modal = document.getElementById('successModal');
      var msgEl = document.getElementById('modalMessage');
      if (modal && msgEl) { msgEl.textContent = msg; modal.classList.add('show'); }
    }
    function closeSuccessModal() {
      var modal = document.getElementById('successModal');
      if (modal) { modal.classList.remove('show'); resetForm(); }
    }
    function showError(msg) { alert('錯誤：' + msg); }
  </script>
</body>
</html>
